<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>G√©n√©rateur de mot de passe s√©curis√©</title>
  <style>
    /* Styles globaux */
    :root {
      --bg-light: #f0f0f0;
      --text-light: #333;
      --bg-dark:  #222;
      --text-dark: #eee;
      --accent:    #4CAF50;
      --strength-weak: #e74c3c;    /* Rouge */
      --strength-medium: #f1c40f;  /* Jaune */
      --strength-strong: #2ecc71;  /* Vert */
      --strength-very-strong: #0a7a3b; /* Vert fonc√© */
    }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: var(--bg-light);
      color: var(--text-light);
      transition: background-color 0.3s, color 0.3s;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 1rem; /* Added padding for smaller screens */
      box-sizing: border-box; /* Include padding in element's total width and height */
    }
    body.dark {
      background-color: var(--bg-dark);
      color: var(--text-dark);
    }
    .container {
      background: rgba(255,255,255,0.8);
      padding: 2rem;
      border-radius: 1rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      max-width: 450px; /* Adjusted max-width as fewer options */
      width: 100%;
    }
    body.dark .container {
      background: rgba(0,0,0,0.6);
    }
    h1 {
      text-align: center;
      margin-bottom: 1rem;
    }
    .controls {
      display: grid;
      gap: 0.75rem;
    }
    .controls label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .controls .char-option {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .controls .char-option .min-input-group {
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }
    .controls .char-option input[type="number"] {
        width: 60px;
        text-align: center;
    }

    select, input[type="text"], input[type="number"] {
      width: 100%;
      padding: 0.5rem;
      font-size: 1rem;
      border-radius: 0.5rem;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    body.dark select, 
    body.dark input[type="text"],
    body.dark input[type="number"] {
      background: #444;
      border-color: #555;
      color: var(--text-dark);
    }
    button {
      cursor: pointer;
      background: var(--accent);
      color: white;
      border: none;
      padding: 0.75rem;
      font-size: 1rem;
      border-radius: 0.5rem;
    }
    button:hover {
      opacity: 0.9;
    }
    .password-output-group {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    .password-output-group input[type="text"] {
        flex-grow: 1;
    }
    .password-output-group button {
        width: auto;
        padding: 0.5rem 0.75rem;
        background: #6c757d;
    }
    .password-output-group button:hover {
        background: #5a6268;
    }

    .strength {
      text-align: center;
      margin-top: 0.5rem;
      font-weight: bold;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    .strength-bar {
      height: 10px;
      border-radius: 5px;
      background-color: #ddd;
      overflow: hidden;
    }
    .strength-indicator {
      height: 100%;
      width: 0%;
      background-color: var(--strength-weak);
      transition: width 0.3s ease-in-out, background-color 0.3s ease-in-out;
    }
    .strength-text {
      color: var(--text-light);
    }
    .error-message {
        color: #e74c3c;
        font-size: 0.85rem;
        text-align: center;
        min-height: 1.2rem;
    }
    .toggle-theme {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="toggle-theme">
      <button id="themeToggle">Mode sombre</button>
    </div>
    <h1>G√©n√©rateur de mot de passe</h1>
    <div class="controls">
      <label>
        Longueur totale:
        <select id="lengthSelect">
          <option value="8">8 caract√®res</option>
          <option value="12">12 caract√®res</option>
          <option value="16" selected>16 caract√®res</option>
          <option value="20">20 caract√®res</option>
          <option value="24">24 caract√®res</option>
          <option value="30">30 caract√®res</option>
          <option value="40">40 caract√®res</option>
          <option value="50">50 caract√®res</option>
        </select>
      </label>
      
      <div class="char-option">
        <label><input type="checkbox" id="includeLower" checked> Minuscules (a-z)</label>
        <div class="min-input-group">
            <label for="minLower">Min:</label>
            <input type="number" id="minLower" value="3" min="0" max="50">
        </div>
      </div>
      <div class="char-option">
        <label><input type="checkbox" id="includeUpper" checked> Majuscules (A-Z)</label>
        <div class="min-input-group">
            <label for="minUpper">Min:</label>
            <input type="number" id="minUpper" value="3" min="0" max="50">
        </div>
      </div>
      <div class="char-option">
        <label><input type="checkbox" id="includeDigits" checked> Chiffres (0-9)</label>
        <div class="min-input-group">
            <label for="minDigits">Min:</label>
            <input type="number" id="minDigits" value="3" min="0" max="50">
        </div>
      </div>
      <div class="char-option">
        <label><input type="checkbox" id="includeSpecial" checked> Caract√®res sp√©ciaux (%$!@#^&*) </label>
        <div class="min-input-group">
            <label for="minSpecial">Min:</label>
            <input type="number" id="minSpecial" value="5" min="0" max="50">
        </div>
      </div>

      <button id="generateBtn">G√©n√©rer</button>
      <div id="errorMessage" class="error-message"></div> 
      <div class="password-output-group">
        <input type="text" id="passwordOutput" readonly placeholder="Votre mot de passe">
        <button id="toggleVisibilityBtn" title="Afficher/Masquer le mot de passe">üôà</button> 
      </div>
      <button id="copyBtn">Copier&nbsp;üìã</button>
      
      <div id="strengthDisplay" class="strength">
        <div class="strength-bar">
          <div id="strengthIndicator" class="strength-indicator"></div>
        </div>
        <div id="strengthText" class="strength-text">Robustesse : Non √©valu√©e</div>
      </div>
    </div>
  </div>

  <script>
    // √âl√©ments du DOM (centralis√©s)
    const DOMElements = {
        lengthSelect:           document.getElementById('lengthSelect'),
        includeLower:           document.getElementById('includeLower'),
        minLower:               document.getElementById('minLower'),
        includeUpper:           document.getElementById('includeUpper'),
        minUpper:               document.getElementById('minUpper'),
        includeDigits:          document.getElementById('includeDigits'),
        minDigits:              document.getElementById('minDigits'),
        includeSpecial:         document.getElementById('includeSpecial'),
        minSpecial:             document.getElementById('minSpecial'),
        generateBtn:            document.getElementById('generateBtn'),
        passwordOutput:         document.getElementById('passwordOutput'),
        toggleVisibilityBtn:    document.getElementById('toggleVisibilityBtn'),
        copyBtn:                document.getElementById('copyBtn'),
        strengthText:           document.getElementById('strengthText'),
        strengthIndicator:      document.getElementById('strengthIndicator'),
        strengthDisplay:        document.getElementById('strengthDisplay'),
        themeToggle:            document.getElementById('themeToggle'),
        body:                   document.body,
        errorMessage:           document.getElementById('errorMessage')
    };

    // Jeu de caract√®res de base
    const BASE_CHAR_SETS = {
      lower:   'abcdefghijklmnopqrstuvwxyz',
      upper:   'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
      digits:  '0123456789',
      special: '%$!@#^&*' 
    };

    /**
     * G√©n√®re un mot de passe s√©curis√©.
     * Garantie : au moins le nombre sp√©cifi√© de chaque type s√©lectionn√©.
     * Tente de g√©n√©rer un mot de passe "Tr√®s fort" par d√©faut.
     */
    function generatePassword() {
      DOMElements.errorMessage.textContent = ''; // Effacer le message d'erreur pr√©c√©dent

      const length = parseInt(DOMElements.lengthSelect.value);
      let characterRequirements = [];
      let totalGuaranteedCount = 0;
      let allCharsPool = ''; // Pool de tous les caract√®res possibles pour les caract√®res restants

      // Collecter les exigences de caract√®res et calculer le total garanti
      if (DOMElements.includeLower.checked) {
        const count = parseInt(DOMElements.minLower.value) || 0;
        characterRequirements.push({ type: 'lower', chars: BASE_CHAR_SETS.lower, minCount: count });
        totalGuaranteedCount += count;
        allCharsPool += BASE_CHAR_SETS.lower;
      }
      if (DOMElements.includeUpper.checked) {
        const count = parseInt(DOMElements.minUpper.value) || 0;
        characterRequirements.push({ type: 'upper', chars: BASE_CHAR_SETS.upper, minCount: count });
        totalGuaranteedCount += count;
        allCharsPool += BASE_CHAR_SETS.upper;
      }
      if (DOMElements.includeDigits.checked) {
        const count = parseInt(DOMElements.minDigits.value) || 0;
        characterRequirements.push({ type: 'digits', chars: BASE_CHAR_SETS.digits, minCount: count });
        totalGuaranteedCount += count;
        allCharsPool += BASE_CHAR_SETS.digits;
      }
      if (DOMElements.includeSpecial.checked) {
        const count = parseInt(DOMElements.minSpecial.value) || 0;
        characterRequirements.push({ type: 'special', chars: BASE_CHAR_SETS.special, minCount: count });
        totalGuaranteedCount += count;
        allCharsPool += BASE_CHAR_SETS.special;
      }

      if (characterRequirements.length === 0) {
        DOMElements.errorMessage.textContent = 'Veuillez s√©lectionner au moins un type de caract√®res.';
        return '';
      }

      if (totalGuaranteedCount > length) {
        DOMElements.errorMessage.textContent = `Le nombre minimum de caract√®res requis (${totalGuaranteedCount}) d√©passe la longueur totale (${length}). Veuillez ajuster.`;
        return '';
      }

      // Assurez-vous que le pool n'est pas vide si la longueur totale est > 0
      if (allCharsPool.length === 0 && length > 0) {
        DOMElements.errorMessage.textContent = 'Aucun type de caract√®re n\'a √©t√© s√©lectionn√© pour g√©n√©rer le mot de passe.';
        return '';
      }

      let pwdArray = [];

      // 1) Garantir le minimum de chaque type s√©lectionn√©
      characterRequirements.forEach(req => {
        for (let i = 0; i < req.minCount; i++) {
          const charIndex = crypto.getRandomValues(new Uint32Array(1))[0] % req.chars.length;
          pwdArray.push(req.chars.charAt(charIndex));
        }
      });
      
      // 2) Remplir le reste du mot de passe jusqu'√† la longueur souhait√©e
      const remainingLength = length - pwdArray.length;
      for (let i = 0; i < remainingLength; i++) {
        const charIndex = crypto.getRandomValues(new Uint32Array(1))[0] % allCharsPool.length;
        pwdArray.push(allCharsPool.charAt(charIndex));
      }

      // 3) M√©langer et retourner
      return shuffleArray(pwdArray).join('');
    }

    /**
     * M√©lange un tableau (algorithme de Fisher‚ÄìYates).
     */
    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = crypto.getRandomValues(new Uint32Array(1))[0] % (i + 1);
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    /**
     * √âvalue la force du mot de passe selon longueur et diversit√©.
     * Score plus pr√©cis bas√© sur le nombre de chaque type.
     */
    function evaluateStrength(pwd) {
      if (!pwd) {
        return { text: 'Non √©valu√©e', score: 0 };
      }

      let score = 0;
      const length = pwd.length;

      // Score de longueur (logarithmique pour mieux repr√©senter la complexit√©)
      // Ajust√© pour que 16 caract√®res avec diversit√© soit "Tr√®s fort"
      score += Math.log2(length) * 5; 

      // Compte des types de caract√®res et score de vari√©t√©
      let typesCount = 0;
      if (/[a-z]/.test(pwd)) typesCount++;
      if (/[A-Z]/.test(pwd)) typesCount++;
      if (/[0-9]/.test(pwd)) typesCount++;
      if (/[%\$!@#\^&\*]/.test(pwd)) typesCount++; // Correspond au BASE_CHAR_SETS.special
      
      score += typesCount * 10; // Chaque type ajoute un bonus significatif, plus √©lev√© pour favoriser la diversit√©

      // Score bas√© sur le nombre de chaque type de caract√®re
      score += (pwd.match(/[a-z]/g) || []).length * 0.5;
      score += (pwd.match(/[A-Z]/g) || []).length * 0.7;
      score += (pwd.match(/[0-9]/g) || []).length * 0.6;
      score += (pwd.match(/[%\$!@#\^&\*]/g) || []).length * 0.8;

      // Limiter le score max pour une √©valuation coh√©rente
      const maxScore = 100; 
      score = Math.max(0, Math.min(score, maxScore)); // Score entre 0 et maxScore

      let strengthText = '';
      let strengthLevel = score / maxScore; // Score normalis√© entre 0 et 1

      if (strengthLevel < 0.25) {
        strengthText = 'Faible';
        DOMElements.strengthIndicator.style.backgroundColor = 'var(--strength-weak)';
      } else if (strengthLevel < 0.5) {
        strengthText = 'Moyen';
        DOMElements.strengthIndicator.style.backgroundColor = 'var(--strength-medium)';
      } else if (strengthLevel < 0.75) {
        strengthText = 'Fort';
        DOMElements.strengthIndicator.style.backgroundColor = 'var(--strength-strong)';
      } else {
        strengthText = 'Tr√®s fort';
        DOMElements.strengthIndicator.style.backgroundColor = 'var(--strength-very-strong)';
      }

      DOMElements.strengthIndicator.style.width = `${strengthLevel * 100}%`;
      return { text: strengthText, score: strengthLevel };
    }

    // Fonction pour mettre √† jour la robustesse affich√©e
    function updateStrengthDisplay(pwd = DOMElements.passwordOutput.value) {
        const { text } = evaluateStrength(pwd);
        DOMElements.strengthText.textContent = `Robustesse : ${text}`;
    }

    // Fonction pour ajuster dynamiquement la valeur max des inputs num√©riques
    function adjustMinMaxLimits() {
        const totalLength = parseInt(DOMElements.lengthSelect.value);
        let currentMins = 0;

        const charTypes = ['lower', 'upper', 'digits', 'special'];
        let charMins = {};

        // R√©cup√©rer les valeurs actuelles des minimums pour les types coch√©s
        charTypes.forEach(type => {
            const checkbox = DOMElements[`include${type.charAt(0).toUpperCase() + type.slice(1)}`];
            const minInput = DOMElements[`min${type.charAt(0).toUpperCase() + type.slice(1)}`];
            charMins[type] = parseInt(minInput.value) || 0;
            if (checkbox.checked) {
                currentMins += charMins[type];
            }
        });

        // Mettre √† jour le 'max' pour chaque champ 'min'
        charTypes.forEach(type => {
            const minInput = DOMElements[`min${type.charAt(0).toUpperCase() + type.slice(1)}`];
            const checkbox = DOMElements[`include${type.charAt(0).toUpperCase() + type.slice(1)}`];
            const otherMins = currentMins - charMins[type];
            
            // Le max d'un champ est la longueur totale moins les minimums des AUTRES types d√©j√† coch√©s
            let newMax = checkbox.checked ? Math.max(0, totalLength - otherMins) : 0;
            minInput.max = newMax;
            
            // Assurer que la valeur actuelle ne d√©passe pas le nouveau max
            if (parseInt(minInput.value) > newMax) {
                minInput.value = newMax;
            }
        });
    }

    // Gestionnaires d'√©v√©nements
    DOMElements.generateBtn.addEventListener('click', () => {
      const pwd = generatePassword();
      DOMElements.passwordOutput.value = pwd;
      // Le champ est d√©j√† de type 'text', donc pas besoin de changer
      // DOMElements.passwordOutput.type = 'text'; // Cette ligne n'est plus n√©cessaire ici
      DOMElements.toggleVisibilityBtn.textContent = 'üôà'; // Met l'ic√¥ne "masquer" par d√©faut
      updateStrengthDisplay(pwd);
      DOMElements.passwordOutput.focus(); 
      //DOMElements.passwordOutput.select(); // Selectionne le mot de passe g√©n√©r√©
    });

    DOMElements.copyBtn.addEventListener('click', () => {
      const pwd = DOMElements.passwordOutput.value;
      if (!pwd) return;
      navigator.clipboard.writeText(pwd)
        .then(() => { 
            DOMElements.copyBtn.textContent = 'Copi√© !'; 
            setTimeout(() => DOMElements.copyBtn.textContent = 'Copier üìã', 1500); 
        })
        .catch(() => { 
            DOMElements.errorMessage.textContent = '√âchec de la copie. Veuillez copier manuellement.';
            setTimeout(() => DOMElements.errorMessage.textContent = '', 3000); 
        });
    });

    DOMElements.toggleVisibilityBtn.addEventListener('click', () => {
        if (DOMElements.passwordOutput.type === 'password') {
            DOMElements.passwordOutput.type = 'text';
            DOMElements.toggleVisibilityBtn.textContent = 'üôà';
        } else {
            DOMElements.passwordOutput.type = 'password';
            DOMElements.toggleVisibilityBtn.textContent = 'üëÅÔ∏è';
        }
    });

    DOMElements.themeToggle.addEventListener('click', () => {
      DOMElements.body.classList.toggle('dark');
      DOMElements.themeToggle.textContent = DOMElements.body.classList.contains('dark') ? 'Mode clair' : 'Mode sombre';
    });

    // √âcouteurs pour les options de caract√®res et les minimums
    const charOptionInputs = [
      { checkbox: DOMElements.includeLower, number: DOMElements.minLower },
      { checkbox: DOMElements.includeUpper, number: DOMElements.minUpper },
      { checkbox: DOMElements.includeDigits, number: DOMElements.minDigits },
      { checkbox: DOMElements.includeSpecial, number: DOMElements.minSpecial }
    ];

    charOptionInputs.forEach(item => {
      item.number.disabled = !item.checkbox.checked; // D√©sactiver si d√©coch√© au chargement
      
      // Quand la checkbox change
      item.checkbox.addEventListener('change', () => {
        item.number.disabled = !item.checkbox.checked;
        if (!item.checkbox.checked) {
          item.number.value = '0'; // R√©initialiser √† 0 si d√©coch√©
        } else {
            if (parseInt(item.number.value) === 0 || item.number.value === '') {
                item.number.value = '1'; // Remettre √† 1 si re-coch√© et qu'il √©tait √† 0
            }
        }
        adjustMinMaxLimits(); 
        updateStrengthDisplay(); 
        DOMElements.generateBtn.click(); // Re-g√©n√©rer le mot de passe
      });

      // Quand le champ num√©rique change
      item.number.addEventListener('input', () => {
          // Si la valeur est 0, d√©cocher la checkbox (et d√©sactiver l'input)
          if (parseInt(item.number.value) === 0) {
              item.checkbox.checked = false;
              item.number.disabled = true; // S'assurer qu'il est d√©sactiv√©
          } else {
              item.checkbox.checked = true;
              item.number.disabled = false; // S'assurer qu'il est activ√©
          }
          adjustMinMaxLimits(); 
          updateStrengthDisplay(); 
          DOMElements.generateBtn.click(); // Re-g√©n√©rer le mot de passe
      });
    });
    
    // √âcouteurs pour la mise √† jour de la robustesse et des limites lors des changements de longueur
    DOMElements.lengthSelect.addEventListener('change', () => {
        adjustMinMaxLimits();
        updateStrengthDisplay();
        DOMElements.generateBtn.click(); // Re-g√©n√©rer le mot de passe
    });

    // G√©n√©rer un mot de passe au chargement et initialiser
    window.addEventListener('load', () => {
        // Initialiser l'√©tat des checkboxes et inputs num√©riques
        charOptionInputs.forEach(item => {
            item.number.disabled = !item.checkbox.checked;
        });

        // S'assurer que toutes les options sont coch√©es par d√©faut pour un mot de passe tr√®s fort
        DOMElements.includeLower.checked = true;
        DOMElements.includeUpper.checked = true;
        DOMElements.includeDigits.checked = true;
        DOMElements.includeSpecial.checked = true;
        DOMElements.minLower.value = '3';
        DOMElements.minUpper.value = '3';
        DOMElements.minDigits.value = '3';
        DOMElements.minSpecial.value = '5';

        // S√©lectionner une longueur plus √©lev√©e par d√©faut pour "Tr√®s fort"
        DOMElements.lengthSelect.value = '20'; 

        // Rendre le champ du mot de passe de type "text" par d√©faut
        DOMElements.passwordOutput.type = 'text'; 
        DOMElements.toggleVisibilityBtn.textContent = 'üôà'; // Mettre l'ic√¥ne pour masquer
        
        adjustMinMaxLimits(); // Initialiser les limites au chargement
        DOMElements.generateBtn.click(); // G√©n√©rer un premier mot de passe
    });
  </script>
</body>
</html>